<!DOCTYPE html>
<html lang='zh-Hans'><head>
  <meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
  <title></title>
</head><body>

<style>
/* latin */
@font-face {
  font-family: 'ABeeZee';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url(/fonts/esDR31xSG-6AGleN2tWkkJUEGpA.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
/* latin-ext */
@font-face {
  font-family: 'ABeeZee';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url(/fonts/esDR31xSG-6AGleN2tukkJUEGpCeGQ.woff2) format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
/* latin */
@font-face {
  font-family: 'ABeeZee';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: url(/fonts/esDT31xSG-6AGleN2tCUkp8DOJKuGA.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
/* latin-ext */
@font-face {
  font-family: 'ABeeZee';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: url(/fonts/esDT31xSG-6AGleN2tCUnJ8DOJKuGPLB.woff2) format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'ChillRoundF';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url(/fonts/ChillRoundF.woff2) format('woff2');
}

body {
  margin: 0;
  padding: 0;
  line-height: 1;
  background: #606060;
}

#container {
  margin: 0 auto;
  height: 100vh;
  width: 100%;
  max-width: 111.11vh;
  position: relative;
  background: #fef4e4;
  overflow: hidden;

  font-family: 'ABeeZee', 'ChillRoundF', sans-serif;
  line-height: 1;
  font-size: 4vh;
}

#container > div > * {
  position: absolute;
}

#container > div {
  transition: opacity 0.2s ease;
}

.maybe-hidden {
  transition: opacity 0.2s ease;
}
.hidden {
  opacity: 0 !important;
  pointer-events: none;
  cursor: auto;
}

p {
  margin: 0;
  padding: 0;
}

button {
  cursor: pointer;
  border: none;
  background: none;
  margin: 0;
  padding: 0;
}
</style>

<div id='container'>

<!-- Main viewport width = min(100vw, 111.11vh) -->

<div>
  <img src='img/fox-nn.webp' style='width: max(60%, 50vh)' id='scene-startup-foxnn-logo'>
  <style>
  #scene-startup-foxnn-logo {
    left: calc(97% - calc(max(60%, 50vh) / 2));
    top: 10%;
    transform: rotate(90deg);
    transition: left 1.5s ease, top 1.5s ease, transform 1.5s ease, opacity 0.2s ease;
  }
  #scene-startup-foxnn-logo.run {
    left: 0%;
    top: 0%;
    transform: rotate(0deg) scale(0.75);
  }
  </style>
</div>
<div id='scene-startup-1'>
  <p style='left: 5%; top: 12.5%; font-size: 10.5vh; line-height: 1.5;'>The<br>Rolling Tail<br>Headlines</p>
  <button style='width: max(60%, 50vh); height: clamp(50vh, 60vw, 66.67vh); left: calc(97% - calc(max(60%, 50vh) / 2)); top: 10%; border-radius: 50%; transform: scale(1.1); z-index: 99' id='btn-start'></button>

  <img src='img/pen.webp' style='height: 14.22%; left: 5.6%; top: 66.7%'>
  <p style='left: calc(7% + 14.22vh); top: 67.2%; font-size: 7.2vh;'>简体中文</p>
  <p style='left: calc(7% + 14.22vh); top: 75.7%; font-size: 4.8vh; opacity: 0.5'>zh-Hans</p>
  <button style='left: calc(7% + 14.22vh); top: 67.2%; width: 100vw; height: 13%' id='btn-lang'></button>
</div>
<div id='scene-startup-2' class='hidden'>
  <div style='left: 57%; width: 40%; top: 12.5%; height: 40%; font-size: 5.6vh; display: table'><p style='display: table-cell; vertical-align: middle; line-height: 1.5'>In the 22<sup>nd</sup> century, foxes are the playful super-wizards.</p></div>
  <p style='left: 5%; width: 90%; top: 62%; font-size: 4.8vh; line-height: 1.5'>Fox Newroll Network takes you around the world with our one-of-a-kind fox magic of “heads or tails”. Join us in our exploration!</p>
  <p style='left: 5%; width: 90%; top: 88%; font-size: 4.8vh; line-height: 1.5; opacity: 0.5' id='scene-startup-press' class='maybe-hidden hidden'>Loading…</p>
</div>


<div id='scene-game' class='hidden' style='transition: opacity 0.5s ease'>
  <img src='' id='scene-game-illustration'>
  <div style='background: linear-gradient(rgba(254, 244, 228, 75%) 80%, transparent 100%); height: 20%; width: 100%; top: 0; left: 0; transition: opacity 0.5s ease' id='coin-text-background-head'></div>
  <div style='background: linear-gradient(transparent 0%, rgba(254, 244, 228, 75%) 20%); height: 20%; width: 100%; top: 80%; left: 0; transition: opacity 0.5s ease' id='coin-text-background-tail'></div>
  <div id='coin-text-head'>
    <img src='img/coin-small-head.webp' style='height: 14.22vh; top: 5vh'>
    <div style='font-size: 6vh; top: 5vh; width: calc(88% - 14.22vh); height: 14.22vh; display: table'><p style='display: table-cell; vertical-align: middle' id='coin-text-content-head'>A</p></div>
  </div>
  <div id='coin-text-tail'>
    <img src='img/coin-small-tail.webp' style='height: 14.22vh; top: 0.78vh'>
    <div style='font-size: 6vh; top: 0.78vh; width: calc(88% - 14.22vh); height: 14.22vh; display: table'><p style='display: table-cell; vertical-align: middle' id='coin-text-content-tail'>B</p></div>
  </div>
  <div style='width: 55vh; height: 55vh; top: 21vh; border-radius: 50%; border: black 1vh solid; transition: opacity 0.5s ease; background: #fef4e4' id='coin-flipping'>
    <img style='width: 100%; height: 100%' src='img/coin-head.webp' id='coin-flipping-head'>
    <img style='width: 100%; height: 100%' src='img/coin-tail.webp' id='coin-flipping-tail'>
  </div>
  <style>
  #scene-game-illustration {
    width: 100%; height: 100%; left: 0; top: 0; transition: opacity 0.5s ease;
    object-fit: cover;
    object-position: center;
  }
  #coin-text-head, #coin-text-tail {
    transition: top 0.5s cubic-bezier(0.25, 1, 0.5, 1), opacity 0.5s cubic-bezier(0.37, 0, 0.63, 1);
    position: relative;
    left: 0; width: 100%;
    height: 20%;
  }
  #coin-text-head.hidden { top: 2%; }
  #coin-text-tail.hidden { top: 78%; }
  #coin-text-head { top: 0%; }
  #coin-text-tail { top: 80%; }
  #coin-text-head.hidden.other-side { top: -0.5%; }
  #coin-text-tail.hidden.other-side { top: 80.5%; }
  #coin-text-head.hidden.other-side,
  #coin-text-tail.hidden.other-side {
    transition: top 0.5s cubic-bezier(0.5, 0, 0.75, 0), opacity 0.2s cubic-bezier(0.45, 0, 0.55, 1);
  }
  #coin-text-head > *, #coin-text-tail > * {
    position: absolute;
  }
  #coin-text-head > img,
  #coin-text-tail > img {
    left: 5%;
  }
  #scene-game.hflip > #coin-text-head > img,
  #scene-game.hflip > #coin-text-tail > img {
    left: calc(95% - 14.22vh);
  }
  #coin-text-head > div,
  #coin-text-tail > div {
    left: calc(14.22vh + 8%);
  }
  #scene-game.hflip > #coin-text-head > div,
  #scene-game.hflip > #coin-text-tail > div {
    left: 4%;
    text-align: end;
  }
  #coin-flipping { left: calc(67% - 27.5vh); }
  #scene-game.hflip #coin-flipping { left: calc(33% - 27.5vh); }
  </style>
</div>


<div id='scene-newspaper' class='hidden' style='transition: opacity 0.5s ease'>
<style>
#scene-newspaper {
  height: 100%;
  overflow: scroll;
}
#newspaper-container {
  padding: 10vh 5vh;
  position: static !important;
}
#newspaper-container.unfinished {
  padding-bottom: 0;
}
#newspaper-container.unfinished .newspaper-page:last-child() {
  margin-bottom: 0;
}
#newspaper-container p {
  line-height: 1.5;
  margin: 1ex 0;
}
#newspaper-container hr {
  border: none;
  border-top: 0.5vh rgba(128, 128, 128, 50%) solid;
  margin: 2ex 0;
}
#newspaper-container hr.header-end {
  border-top: 0.5vh black solid;
}
#newspaper-container a {
  color: #864;
}
.newspaper-page {
  border-top: 1vh black solid;
  padding: 1ex 0;
  margin: 10vh 0;
}
.newspaper-page-num {
  text-align: end;
  opacity: 0.5;
  font-size: 8vh;
  font-weight: bold;
  margin: 0.25ex 0 -2ex !important;
  line-height: 1 !important;
}
</style>

<div id='newspaper-container'>
  <div id='newspaper-header' style='text-align: center'>
    <img src='img/fox-nn.webp' style='width: min(90%, 55vh); display: inline-block; margin-top: 5vh'>
    <p style='font-size: 8vh; line-height: 1; margin: 1ex 0 0.7ex'>The Rolling Tail Gazette</p>
    <p style='margin: 0 0 2ex'><i>22<sup>nd</sup> Century Ed.</i> <span style='opacity: 0.1'>|</span> <i>Issue <span id='newspaper-issue-num'></span></i> <span style='opacity: 0.1'>|</span> <i>Fox Newroll Network</i></p>
    <hr class='header-end'>
  </div>
</div>
</div>

</div></div>


<script src='https://cdn.jsdelivr.net/npm/marked@15.0.6/marked.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/dompurify@3.2.3/dist/purify.min.js'></script>
<script>
const api = 'http://127.0.0.1:25117'
let gameHandle = null   // { uuid, topics: [[string; 2]; 3] }

const preloadImages = (images, callback) => {
  let count = 0
  for (const name of images) {
    const i = new Image()
    i.onload = () => {
      i.onload = undefined
      count += 1
      callback(count, images.length)
    }
    i.src = name
  }
}
preloadImages([
  'img/coin-head.webp',
  'img/coin-tail.webp',
  'img/coin-small-head.webp',
  'img/coin-small-tail.webp',
], (n) => console.log(n))

const delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms))

let pressAnywhereFn = null
const pressAnywhereOnce = (fn) => pressAnywhereFn = fn
const execPressAnywhereFn = () => {
  if (pressAnywhereFn) {
    const fn = pressAnywhereFn
    pressAnywhereFn = null
    fn()
  }
}
document.getElementById('container').addEventListener('click', (e) => execPressAnywhereFn())
window.addEventListener('keydown', (e) => {
  if (e.keyCode === 32) execPressAnywhereFn()
})

document.getElementById('btn-lang').addEventListener('click', (e) => {
  alert('!')
})

const header = document.getElementById('newspaper-header')
header.remove()
let newspaperImagesDone = []  // Updated by `playNewspaper`
let newspaperImages = []  // Filled by this function, `parseNewspaper`, in case of enlengthened blockage
const parseNewspaper = (issueNum, s) => {
  const container = document.getElementById('newspaper-container')
  container.replaceChildren()

  const pages = s.split('~~++ page separator ++~~')
  let pageNum = 0
  for (const page of pages) {
    pageNum++
    const html = DOMPurify.sanitize(marked.parse(page))
    const pageEl = document.createElement('div')
    pageEl.classList.add('newspaper-page')
    pageEl.innerHTML = html
    container.append(pageEl)

    // Illustration
    if (pageNum > 1) {
      const illustEl = document.createElement('img')
      illustEl.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=' // 1-pixel transparent PNG
      illustEl.style.width = '50vh'
      if ((issueNum + pageNum) % 2 === 0) {
        illustEl.style.float = 'left'
        illustEl.style.marginRight = '4vh'
      } else {
        illustEl.style.float = 'right'
        illustEl.style.marginLeft = '4vh'
      }
      illustEl.style.marginBottom = '2vh'
      if (pageEl.children.length > 2) {
        pageEl.insertBefore(illustEl, pageEl.children[2])
      }
      // Confirm completion before setting source
      if (newspaperImagesDone[pageNum - 2])
        illustEl.src = `issue/${issueNum}/illust/${pageNum - 1}`
      else
        newspaperImages[pageNum - 2] = illustEl
    }

    // Page number
    if (pageNum === 1) {
      pageEl.prepend(header.cloneNode(/* deep: */ true))
      document.getElementById('newspaper-issue-num').innerText = issueNum.toString()
    } else {
      const pageNumEl = document.createElement('p')
      pageNumEl.classList.add('newspaper-page-num')
      pageNumEl.innerText = pageNum.toString()
      pageEl.prepend(pageNumEl)
    }
  }
}

let newspaperAtBottom = true
let lastAtBottomTrue = 0
const sceneNewspaper = document.getElementById('scene-newspaper')
const newspaperContainer = document.getElementById('newspaper-container')
sceneNewspaper.addEventListener('wheel', (e) => {
  const H = sceneNewspaper.clientHeight
  const h = newspaperContainer.clientHeight
  const currentAtBottom = (sceneNewspaper.scrollTop >= h - H * 1.2)
  if (!currentAtBottom && lastAtBottomTrue < Date.now() - 500) {
    newspaperAtBottom = false
  } else if (currentAtBottom) {
    newspaperAtBottom = true
    lastAtBottomTrue = Date.now()
  }
})
const playNewspaper = async (issueNum, autoScroll) => {
  const scene = document.getElementById('scene-newspaper')
  const container = document.getElementById('newspaper-container')
  container.classList.add('unfinished')

  for (let i = 0; i < 3; i++) {
    ;(async () => {
      while (true) {
        const text = await (await fetch(`${api}/issue/${issueNum}/illust/${i + 1}/done`)).text()
        if (parseInt(text) === 1) break
        await delay(1000)
      }
      newspaperImagesDone[i] = true
      if (newspaperImages[i])
        newspaperImages[i].src = `issue/${issueNum}/illust/${i + 1}`
    })()
  }

  const stream = (await fetch(`${api}/issue/${issueNum}/raw`)).body
  const chunks = []
  for await (const chunk of stream) {
    chunks.push((new TextDecoder()).decode(chunk))
    parseNewspaper(issueNum, chunks.join(''))
    if (autoScroll && newspaperAtBottom)
      scene.scrollTo({
        top: container.clientHeight - scene.clientHeight,
        left: 0,
        behavior: 'smooth',
      })
  }

  // Link
  const linkEl = document.createElement('a')
  linkEl.href = `/${issueNum}`
  linkEl.target = '_blank'
  linkEl.innerText = 'Permalink'
  container.appendChild(linkEl)

  container.classList.remove('unfinished')
  if (autoScroll && newspaperAtBottom)
    scene.scrollTo({
      top: container.clientHeight - scene.clientHeight,
      left: 0,
      behavior: 'smooth',
    })
}

// Returns an integer in [0, range), seeded by `str`
const randomWithSeed = (range, str) => {
  // Fx Hash with Firefox secret power ^ ^
  // https://github.com/cbreeden/fxhash/blob/a03cbf4/lib.rs#L70
  // Assumes little endian
  const fxHash32 = (data) => {
    const ROTATE = 5
    const SEED32 = 0x9e3779b9
    const rotl32 = (x, r) => ((x << r) | (x >>> (32 - r))) >>> 0

    let hash = 0
    const n = data.length
    let i = 0
    for (; i + 4 < n; i += 4) {
      const word = data[i] | (data[i + 1] << 8) | (data[i + 2] << 16) | (data[i + 3] << 24)
      hash = Math.imul(rotl32(hash, ROTATE) ^ word, SEED32)
    }
    if (i + 2 < n) {
      const word = data[i] | (data[i + 1] << 8)
      hash = Math.imul(rotl32(hash, ROTATE) ^ word, SEED32)
      i += 2
    }
    if (i + 1 < n) {
      hash = Math.imul(rotl32(hash, ROTATE) ^ data[i], SEED32)
    }

    return hash >>> 0
  }
  return (fxHash32((new TextEncoder()).encode(str)) >>> 7) % range
}
const illustNums = [] // Initialised at start-game request
const playScene = async (index) => {
  // Reset all elements to hidden state
  document.getElementById('scene-game').classList.add('hidden')
  await delay(1000)
  document.getElementById('coin-text-background-head').classList.add('hidden')
  document.getElementById('coin-text-background-tail').classList.add('hidden')
  document.getElementById('coin-text-head').classList.add('hidden')
  document.getElementById('coin-text-tail').classList.add('hidden')
  document.getElementById('coin-text-head').classList.remove('other-side')
  document.getElementById('coin-text-tail').classList.remove('other-side')
  document.getElementById('coin-text-content-head').innerText = gameHandle.topics[index * 2 + 0] + '…'
  document.getElementById('coin-text-content-tail').innerText = gameHandle.topics[index * 2 + 1] + '…'
  document.getElementById('coin-flipping').classList.add('hidden')
  const illustNum = illustNums[index]
  if (illustNum % 2 === 0) {
    document.getElementById('scene-game').classList.remove('hflip')
  } else {
    document.getElementById('scene-game').classList.add('hflip')
  }
  document.getElementById('scene-game-illustration').remove()
  const illust = new Image()
  illust.id = 'scene-game-illustration'
  illust.src = `img/scene-0${illustNum}.webp`
  document.getElementById('scene-game').prepend(illust)
  await delay(1000)
  document.getElementById('scene-game').classList.remove('hidden')
  await delay(2000)
  document.getElementById('coin-text-background-head').classList.remove('hidden')
  document.getElementById('coin-text-background-tail').classList.remove('hidden')
  document.getElementById('coin-text-head').classList.remove('hidden')
  document.getElementById('coin-text-tail').classList.remove('hidden')
  await delay(2000)
  document.getElementById('coin-flipping').classList.remove('hidden')

  const coin = document.getElementById('coin-flipping')
  const coinImageH = document.getElementById('coin-flipping-head')
  const coinImageT = document.getElementById('coin-flipping-tail')
  const t0 = Date.now() -
    (randomWithSeed(2, gameHandle.topics[index * 2 + 1] + '\\' + gameHandle.topics[index * 2]) ?
     1250 : 0)
  const x = (illustNum % 2 === 0) ? 67 : 33
  let stopTime = null
  let stopTimeAtPress = null
  let animationDone = false
  const updateFrame = () => {
    const t1 = Date.now() - t0
    let t = t1
    // If pressed, jump
    if (stopTimeAtPress !== null) {
      const progress = Math.min(1, (t1 - stopTimeAtPress) / 200)
      const y = 21 - 9 * progress * (1 - progress)
      coin.style.top = `${y}vh`
      if (progress === 1) {
        stopTimeAtPress = null  // Stop further processing
      }
    }
    // If pressed, gradually halt
    if (stopTime !== null && t >= stopTime) {
      const target = stopTime + 1250
      if (t1 > stopTime) {
        // f(t) = 1 - exp(-kt) * (a-t)/a  (0 <= t <= a)
        // f'(0) = (1 + ka) / a = 1  =>  k = (a-1) / a
        const a = 2
        const k = 0.5
        const maxT = target - stopTime
        const T = Math.min(a, (t1 - stopTime) / maxT)
        t = stopTime + maxT * (1 - Math.exp(-k * T) * (a - T) / a)
      }
    }

    const ph = Math.sin(t / 2500 * Math.PI * 2)
    const w = Math.abs(ph) * 55
    coin.style.width = `${w}vh`
    coin.style.left = `calc(${x}% - ${w / 2}vh)`
    if (ph >= 0) {
      coinImageH.style.display = 'inline'
      coinImageT.style.display = 'none'
    } else {
      coinImageT.style.display = 'inline'
      coinImageH.style.display = 'none'
    }
    if (!animationDone) requestAnimationFrame(updateFrame)
  }
  updateFrame()

  pressAnywhereOnce(async () => {
    const t = Date.now() - t0
    stopTimeAtPress = t
    stopTime = t - t % 1250 + 1250 + 625

    const side = (stopTime % 2500 < 1250) ? 1 : 0 // 0 - head; 1 - tail
    const flipResponse /* Promise<string> */ = (await fetch(`${api}/flip`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: `uuid=${gameHandle.uuid}&sel=${index * 2 + side}`
    })).text()

    await delay(stopTime - t + 1500)
    if (side === 0) {
      document.getElementById('coin-text-background-tail').classList.add('hidden')
      document.getElementById('coin-text-tail').classList.add('hidden')
      document.getElementById('coin-text-tail').classList.add('other-side')
    } else {
      document.getElementById('coin-text-background-head').classList.add('hidden')
      document.getElementById('coin-text-head').classList.add('hidden')
      document.getElementById('coin-text-head').classList.add('other-side')
    }
    await delay(1000)
    animationDone = true
    await delay(2500)
    if (index === 2) {
      document.getElementById('scene-game').classList.add('hidden')
      await delay(1000)
      const issueNum = parseInt(await flipResponse)
      playNewspaper(issueNum, /* playNewspaper */ true)
      document.getElementById('scene-newspaper').classList.remove('hidden')
    } else {
      playScene(index + 1)
    }
  })
}

document.getElementById('btn-start').addEventListener('click', async (e) => {
  document.getElementById('btn-lang').setAttribute('tabindex', '-1')
  document.getElementById('btn-start').setAttribute('tabindex', '-1')
  document.getElementById('btn-start').blur()
  document.getElementById('scene-startup-1').classList.add('hidden')
  document.getElementById('scene-startup-foxnn-logo').classList.add('run')

  let nextHintShown = false
  let networkDone = false
  const next = () => {
    document.getElementById('scene-startup-foxnn-logo').classList.add('hidden')
    document.getElementById('scene-startup-2').classList.add('hidden')
    // Sample 3 non-duplicating illustrations
    const illustNumPool = [1, 2, 3, 4, 5, 6, 7, 8]
    for (let i = 0; i < 3; i++) {
      const p = randomWithSeed(illustNumPool.length,
        gameHandle.topics[i * 2] + '/' + gameHandle.topics[i * 2 + 1])
      illustNums[i] = illustNumPool[p]
      const t = illustNumPool.pop()
      if (p !== illustNumPool.length - 1) illustNumPool[p] = t
    }
    playScene(0)
  }

  ;(async () => {
    gameHandle = await (await fetch(`${api}/start`, {
      method: 'POST',
      body: ``
    })).json()
    document.getElementById('scene-startup-press').innerText = 'Press screen/Space key'
    networkDone = true
    if (nextHintShown && networkDone) pressAnywhereOnce(next)
  })()

  ;(async () => {
    await delay(2000)
    document.getElementById('scene-startup-2').classList.remove('hidden')
    await delay(3000)
    document.getElementById('scene-startup-press').classList.remove('hidden')
    nextHintShown = true
    if (nextHintShown && networkDone) pressAnywhereOnce(next)
  })()
})

const playPermalink = async (issueNum) => {
  document.getElementById('scene-startup-foxnn-logo').remove()
  document.getElementById('scene-startup-1').remove()
  document.getElementById('scene-startup-2').remove()
  document.getElementById('scene-game').remove()
  await playNewspaper(issueNum)
  document.getElementById('scene-newspaper').classList.remove('hidden')
}
const pathMatch = new URL(window.location.href).pathname.match(/\/([0-9]+)$/)
if (pathMatch) {
  playPermalink(parseInt(pathMatch[1], 10))
}
</script>

</body></html>

